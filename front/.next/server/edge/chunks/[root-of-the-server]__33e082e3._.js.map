{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: ['query'],\r\n        datasourceUrl: process.env.DATABASE_URL || 'file:./dev.db'\r\n    });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACT,gBAAgB,MAAM,IACtB,IAAI,uKAAY,CAAC;IACb,KAAK;QAAC;KAAQ;IACd,eAAe,QAAQ,GAAG,CAAC,YAAY,IAAI;AAC/C;AAEJ,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'fs')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`fs`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,EAAE,CAAC"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'path')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`path`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/api/reviews/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport const runtime = 'edge';\r\nimport { prisma } from '@/lib/prisma';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nconst DATA_FILE_PATH = path.join(process.cwd(), 'data', 'reviews.json');\r\n\r\nfunction readJsonData() {\r\n    if (!fs.existsSync(DATA_FILE_PATH)) return [];\r\n    const fileData = fs.readFileSync(DATA_FILE_PATH, 'utf-8');\r\n    return JSON.parse(fileData);\r\n}\r\n\r\nfunction writeJsonData(data: any[]) {\r\n    const dir = path.dirname(DATA_FILE_PATH);\r\n    if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\r\n    fs.writeFileSync(DATA_FILE_PATH, JSON.stringify(data, null, 2));\r\n}\r\n\r\n// GET /api/reviews\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const branchId = searchParams.get('branchId');\r\n\r\n        let reviews;\r\n        try {\r\n            reviews = await prisma.review.findMany({\r\n                where: branchId ? { branchId } : undefined,\r\n                orderBy: { createdAt: 'desc' }\r\n            });\r\n        } catch (e) {\r\n            console.warn('Prisma failed, falling back to JSON');\r\n            let allData = readJsonData();\r\n            if (branchId) {\r\n                allData = allData.filter((r: any) => r.branchId === branchId);\r\n            }\r\n            reviews = allData.sort((a: any, b: any) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        }\r\n\r\n        return NextResponse.json(reviews);\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { error: 'Failed to fetch reviews' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// POST /api/reviews - 누구나 작성 가능\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n\r\n        // 유효성 검사\r\n        if (!body.password || body.password.length < 4) {\r\n            return NextResponse.json({ error: '비밀번호는 4자리 이상이어야 합니다.' }, { status: 400 });\r\n        }\r\n\r\n        let review;\r\n        try {\r\n            review = await prisma.review.create({ data: body });\r\n        } catch (e) {\r\n            console.warn('Prisma failed, falling back to JSON');\r\n            const allData = readJsonData();\r\n            const newId = allData.length > 0 ? Math.max(...allData.map((r: any) => r.id)) + 1 : 1;\r\n            review = { ...body, id: newId, createdAt: new Date().toISOString() };\r\n            allData.push(review);\r\n            writeJsonData(allData);\r\n        }\r\n\r\n        return NextResponse.json(review);\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { error: 'Failed to create review' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAGA;AACA;AACA;;AAHO,MAAM,UAAU;;;;AAKhB,MAAM,UAAU;AAEvB,MAAM,iBAAiB,0JAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAExD,SAAS;IACL,IAAI,CAAC,wJAAE,CAAC,UAAU,CAAC,iBAAiB,OAAO,EAAE;IAC7C,MAAM,WAAW,wJAAE,CAAC,YAAY,CAAC,gBAAgB;IACjD,OAAO,KAAK,KAAK,CAAC;AACtB;AAEA,SAAS,cAAc,IAAW;IAC9B,MAAM,MAAM,0JAAI,CAAC,OAAO,CAAC;IACzB,IAAI,CAAC,wJAAE,CAAC,UAAU,CAAC,MAAM,wJAAE,CAAC,SAAS,CAAC,KAAK;QAAE,WAAW;IAAK;IAC7D,wJAAE,CAAC,aAAa,CAAC,gBAAgB,KAAK,SAAS,CAAC,MAAM,MAAM;AAChE;AAGO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI;QACJ,IAAI;YACA,UAAU,MAAM,iIAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;gBACnC,OAAO,WAAW;oBAAE;gBAAS,IAAI;gBACjC,SAAS;oBAAE,WAAW;gBAAO;YACjC;QACJ,EAAE,OAAO,GAAG;YACR,QAAQ,IAAI,CAAC;YACb,IAAI,UAAU;YACd,IAAI,UAAU;gBACV,UAAU,QAAQ,MAAM,CAAC,CAAC,IAAW,EAAE,QAAQ,KAAK;YACxD;YACA,UAAU,QAAQ,IAAI,CAAC,CAAC,GAAQ,IAAW,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QAC9G;QAEA,OAAO,kMAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO,kMAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAEtB;AACJ;AAGO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,SAAS;QACT,IAAI,CAAC,KAAK,QAAQ,IAAI,KAAK,QAAQ,CAAC,MAAM,GAAG,GAAG;YAC5C,OAAO,kMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,IAAI;QACJ,IAAI;YACA,SAAS,MAAM,iIAAM,CAAC,MAAM,CAAC,MAAM,CAAC;gBAAE,MAAM;YAAK;QACrD,EAAE,OAAO,GAAG;YACR,QAAQ,IAAI,CAAC;YACb,MAAM,UAAU;YAChB,MAAM,QAAQ,QAAQ,MAAM,GAAG,IAAI,KAAK,GAAG,IAAI,QAAQ,GAAG,CAAC,CAAC,IAAW,EAAE,EAAE,KAAK,IAAI;YACpF,SAAS;gBAAE,GAAG,IAAI;gBAAE,IAAI;gBAAO,WAAW,IAAI,OAAO,WAAW;YAAG;YACnE,QAAQ,IAAI,CAAC;YACb,cAAc;QAClB;QAEA,OAAO,kMAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO,kMAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}