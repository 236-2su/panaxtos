{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/SSAFY/Desktop/panaxtos/front/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: ['query'],\r\n        datasourceUrl: process.env.DATABASE_URL || 'file:./dev.db'\r\n    });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACT,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACb,KAAK;QAAC;KAAQ;IACd,eAAe,QAAQ,GAAG,CAAC,YAAY,IAAI;AAC/C;AAEJ,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/SSAFY/Desktop/panaxtos/front/lib/jwt.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'default-secret-key';\r\n\r\nexport function generateToken(username: string): string {\r\n    return jwt.sign({ username }, JWT_SECRET, { expiresIn: '7d' });\r\n}\r\n\r\nexport function verifyToken(token: string): { username: string } | null {\r\n    try {\r\n        return jwt.verify(token, JWT_SECRET) as { username: string };\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function getTokenFromRequest(authHeader: string | null): string | null {\r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n        return null;\r\n    }\r\n    return authHeader.substring(7);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,cAAc,QAAgB;IAC1C,OAAO,kJAAG,CAAC,IAAI,CAAC;QAAE;IAAS,GAAG,YAAY;QAAE,WAAW;IAAK;AAChE;AAEO,SAAS,YAAY,KAAa;IACrC,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAM;QACJ,OAAO;IACX;AACJ;AAEO,SAAS,oBAAoB,UAAyB;IACzD,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;QAClD,OAAO;IACX;IACA,OAAO,WAAW,SAAS,CAAC;AAChC","debugId":null}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/SSAFY/Desktop/panaxtos/front/app/api/reservations/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { getTokenFromRequest, verifyToken } from '@/lib/jwt';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_FILE_PATH = path.join(process.cwd(), 'data', 'reservations.json');\r\n\r\nfunction readJsonData() {\r\n    if (!fs.existsSync(DATA_FILE_PATH)) return [];\r\n    const fileData = fs.readFileSync(DATA_FILE_PATH, 'utf-8');\r\n    return JSON.parse(fileData);\r\n}\r\n\r\nfunction writeJsonData(data: any[]) {\r\n    const dir = path.dirname(DATA_FILE_PATH);\r\n    if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\r\n    fs.writeFileSync(DATA_FILE_PATH, JSON.stringify(data, null, 2));\r\n}\r\n\r\n// GET /api/reservations/[id] - 관리자만 (상세 정보)\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    const { id } = await params;\r\n    try {\r\n        const token = getTokenFromRequest(request.headers.get('authorization'));\r\n        if (!token || !verifyToken(token)) {\r\n            return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n        }\r\n\r\n        let reservation;\r\n        try {\r\n            reservation = await prisma.reservation.findUnique({\r\n                where: { id: parseInt(id) }\r\n            });\r\n        } catch (e) {\r\n            console.warn('Prisma failed, falling back to JSON');\r\n            const allData = readJsonData();\r\n            reservation = allData.find((r: any) => r.id === parseInt(id));\r\n        }\r\n\r\n        if (!reservation) {\r\n            return NextResponse.json({ error: 'Not found' }, { status: 404 });\r\n        }\r\n\r\n        return NextResponse.json(reservation);\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { error: 'Failed to fetch reservation' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// PUT /api/reservations/[id] - 관리자 또는 비밀번호 일치 시\r\nexport async function PUT(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    const { id } = await params;\r\n    try {\r\n        const body = await request.json();\r\n        const token = getTokenFromRequest(request.headers.get('authorization'));\r\n        const isAdmin = token && verifyToken(token);\r\n        const password = body.password; // 요청 바디에서 비밀번호 확인\r\n\r\n        let reservation;\r\n        let isPasswordCorrect = false;\r\n\r\n        // 1. 기존 예약 조회\r\n        try {\r\n            reservation = await prisma.reservation.findUnique({ where: { id: parseInt(id) } });\r\n        } catch (e) {\r\n            const allData = readJsonData();\r\n            reservation = allData.find((r: any) => r.id === parseInt(id));\r\n        }\r\n\r\n        if (!reservation) {\r\n            return NextResponse.json({ error: 'Not found' }, { status: 404 });\r\n        }\r\n\r\n        // 2. 권한 확인 (관리자 또는 비밀번호 일치)\r\n        if (isAdmin) {\r\n            isPasswordCorrect = true;\r\n        } else {\r\n            if (password && reservation.password === password) {\r\n                isPasswordCorrect = true;\r\n            }\r\n        }\r\n\r\n        if (!isPasswordCorrect) {\r\n            return NextResponse.json({ error: '비밀번호가 일치하지 않습니다.' }, { status: 403 });\r\n        }\r\n\r\n        // 3. 업데이트\r\n        try {\r\n            // 비밀번호는 업데이트하지 않거나, 새 비밀번호가 있으면 업데이트 (여기서는 제외)\r\n            const { password: _, ...updateData } = body;\r\n            reservation = await prisma.reservation.update({\r\n                where: { id: parseInt(id) },\r\n                data: updateData\r\n            });\r\n        } catch (e) {\r\n            console.warn('Prisma failed, falling back to JSON');\r\n            const allData = readJsonData();\r\n            const index = allData.findIndex((r: any) => r.id === parseInt(id));\r\n            if (index !== -1) {\r\n                // 기존 데이터에 새 데이터 병합 (비밀번호 유지)\r\n                allData[index] = { ...allData[index], ...body, password: allData[index].password };\r\n                writeJsonData(allData);\r\n                reservation = allData[index];\r\n            }\r\n        }\r\n\r\n        return NextResponse.json(reservation);\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { error: 'Failed to update reservation' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// DELETE /api/reservations/[id] - 관리자 또는 비밀번호 일치 시\r\nexport async function DELETE(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    const { id } = await params;\r\n    try {\r\n        // DELETE 요청은 body를 가질 수 있지만, 일부 클라이언트는 지원하지 않을 수 있음.\r\n        // 여기서는 헤더나 query param으로 비밀번호를 받을 수도 있지만, \r\n        // Next.js에서는 Request body를 읽을 수 있음.\r\n        let password = '';\r\n        try {\r\n            const body = await request.json();\r\n            password = body.password;\r\n        } catch (e) {\r\n            // Body가 없는 경우 (관리자 삭제 등)\r\n        }\r\n\r\n        const token = getTokenFromRequest(request.headers.get('authorization'));\r\n        const isAdmin = token && verifyToken(token);\r\n\r\n        let reservation;\r\n        let isPasswordCorrect = false;\r\n\r\n        // 1. 기존 예약 조회 (비밀번호 확인용)\r\n        try {\r\n            reservation = await prisma.reservation.findUnique({ where: { id: parseInt(id) } });\r\n        } catch (e) {\r\n            const allData = readJsonData();\r\n            reservation = allData.find((r: any) => r.id === parseInt(id));\r\n        }\r\n\r\n        if (!reservation) {\r\n            return NextResponse.json({ error: 'Not found' }, { status: 404 });\r\n        }\r\n\r\n        // 2. 권한 확인\r\n        if (isAdmin) {\r\n            isPasswordCorrect = true;\r\n        } else {\r\n            if (password && reservation.password === password) {\r\n                isPasswordCorrect = true;\r\n            }\r\n        }\r\n\r\n        if (!isPasswordCorrect) {\r\n            return NextResponse.json({ error: '비밀번호가 일치하지 않습니다.' }, { status: 403 });\r\n        }\r\n\r\n        // 3. 삭제\r\n        try {\r\n            await prisma.reservation.delete({ where: { id: parseInt(id) } });\r\n        } catch (e) {\r\n            console.warn('Prisma failed, falling back to JSON');\r\n            const allData = readJsonData();\r\n            const newData = allData.filter((r: any) => r.id !== parseInt(id));\r\n            writeJsonData(newData);\r\n        }\r\n\r\n        return new NextResponse(null, { status: 204 });\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { error: 'Failed to delete reservation' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}